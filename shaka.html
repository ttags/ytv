<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Yonotvs Shaka Player - Resilient</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/shaka-player@4.2.7/dist/controls.css">
<style>
  body { margin:0; background:#000; display:flex; justify-content:center; align-items:center; height:100vh; }
  .shaka-video-container { width: 100%; max-width: 1000px; position: relative; }
  video { width: 100%; height: auto; background: black; }
</style>

<script src="https://cdn.jsdelivr.net/npm/shaka-player@4.2.7/dist/shaka-player.compiled.js"></script>
<script src="https://cdn.jsdelivr.net/npm/shaka-player@4.2.7/dist/controls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>

<body>
<div class="shaka-video-container" data-shaka-player>
  <video autoplay playsinline controls></video>
</div>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  const video = document.querySelector('video');

  // --- STREAMS OBJECT --- multi-layered fallback list per ID
  const streamsChain = {
    "1": [
      { url: "https://a201aivottlinear-a.akamaihd.net/OTTB/lhr-nitro/clients/dash/enc/f60kqesunw/out/v1/a435ed7a00f947deb4369b46d8f2fb70/cenc.mpd",
        keyId: "1779c27b9d077a3ba0c9cc1bb9a94b9f", key: "cc5cf3b7928fb9e0a1ee6a8b566f0a8e" },
      { url: "https://yono.b-cdn.net/hls/yono.m3u8" },
      { url: "https://tvsen5.aynaott.com/Ptvsports/index.m3u8" }
    ],
    "2": [
      { url: "https://a204aivottepl-a.akamaihd.net/sin-nitro/live/clients/dash/enc/fdb3pubmek/out/v1/aefca6420f944a9482e117f315de535f/cenc.mpd",
        keyId: "7e9239c1982d984a002df3ed049d0756", key: "1b8a17598129a3618535c8fb05f103fe" },
      { url: "https://yono.b-cdn.net/hls/yono_alt.m3u8" }
    ]
  };

  const urlParams = new URLSearchParams(window.location.search);
  const id = urlParams.get('id') || "1";

  const chain = streamsChain[id];
  if (!chain || chain.length === 0) {
    alert("Invalid stream ID");
    return;
  }

  shaka.polyfill.installAll();
  if (!shaka.Player.isBrowserSupported()) {
    alert('Your browser does not support Shaka Player. Trying HLS.js fallback...');
  }

  const container = document.querySelector('.shaka-video-container');
  const player = new shaka.Player(video);
  const ui = new shaka.ui.Overlay(player, container, video);
  ui.configure({
    controlPanelElements: ['play_pause','time_and_duration','mute','volume','spacer','quality','fullscreen']
  });

  let currentIndex = 0;

  async function tryLoadNextStream() {
    if (currentIndex >= chain.length) {
      alert("All streams failed to load.");
      return;
    }

    const stream = chain[currentIndex];
    const isDash = stream.url.endsWith('.mpd');
    const isHls = stream.url.endsWith('.m3u8');

    // DRM config
    if (stream.keyId && stream.key) {
      player.configure({
        drm: { clearKeys: { [stream.keyId]: stream.key } },
        streaming: { lowLatencyMode: true }
      });
    }

    try {
      if (isDash || (!isDash && !isHls)) {
        await player.load(stream.url);
        console.log("✅ Loaded stream ID:", id, "Index:", currentIndex);
      } else if (isHls && Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(stream.url);
        hls.attachMedia(video);
        console.log("✅ HLS.js loaded fallback stream index:", currentIndex);
      }
    } catch (err) {
      console.warn("❌ Failed stream index", currentIndex, err);
      currentIndex++;
      tryLoadNextStream(); // try next
    }
  }

  tryLoadNextStream();
});
</script>
</body>
</html>
